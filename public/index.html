<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Varcavia Search MVP</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; background: #fcfcfc; }
    input, select { margin: 0.2em 0.5em 0.2em 0; padding: 0.3em; }
    .result { background: #fff; margin: 1em 0; padding: 1em; border-radius: 8px; box-shadow: 0 1px 4px #0001; }
    .preview { color: #444; font-size: 1em; margin-top: 0.2em; white-space: pre-wrap; }
    .meta { font-size: 0.9em; color: #666; }
    label { font-weight: bold; }
    .filters { margin-bottom: 1em; }
    .id { font-size: 0.7em; color: #bbb; }
  </style>
</head>
<body>
  <h2>ðŸ”Ž Varcavia Universal Data Search</h2>
  <div class="filters">
    <label>Testo:</label>
    <input id="q" placeholder="Cerca..."> 
    <label>Fonte:</label>
    <select id="source">
      <option value="">Tutte</option>
      <option value="eba">EBA</option>
      <option value="esma">ESMA</option>
      <option value="eur-oj">EU Official Journal</option>
      <option value="it-gazzetta">Gazzetta IT</option>
      <option value="cnmv">CNMV</option>
      <option value="worldbank">World Bank</option>
    </select>
    <label>Periodo:</label>
    <input id="date" placeholder="AAAA-MM (opz.)" size="7">
    <button onclick="search()">Cerca</button>
  </div>
  <div id="results">Risultati...</div>
<script>
async function search() {
  const q = document.getElementById('q').value.trim();
  const source = document.getElementById('source').value.trim();
  const date = document.getElementById('date').value.trim();
  let query = q;
  if (source) query += ` source:${source}`;
  if (date) query += ` date:${date}`;
  const res = await fetch(`http://localhost:3000/search?q=${encodeURIComponent(query)}`);
  const out = await res.json();
  let html = `<b>${out.length}</b> risultati.<br>`;
  for (const r of out) {
    html += `
      <div class="result">
        <div class="meta">
          <b>${r.title || 'â€”'}</b> <span class="id">${r.id}</span><br>
          <span><b>Fonte:</b> ${r.source || '-'}</span>
          <span><b>Data:</b> ${r.date || '-'}</span>
          <span><b>Hash:</b> ${r.hash ? r.hash.slice(0, 8) : '-'}</span>
          <span><b>Timestamp:</b> ${r.timestamp ? r.timestamp.slice(0, 16) : '-'}</span>
        </div>
        <div class="preview">${r.preview}</div>
      </div>
    `;
  }
  document.getElementById('results').innerHTML = html;
}
window.onload = search;
</script>
</body>
</html>
